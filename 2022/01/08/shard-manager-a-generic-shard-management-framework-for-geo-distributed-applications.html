<!DOCTYPE html>
<html>
  <head>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-LKBDWTJ60B"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-LKBDWTJ60B");
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Shard Manager: A Generic Shard Management Framework for Geo-distributed Applications</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <meta http-equiv="pragma" content="no-cache" />
    <meta name="robots" content="all" />
    <meta name="MSSmartTagsPreventParsing" content="true" />
    <meta http-equiv="imagetoolbar" content="false" />

    <link href="/css/tufte.css" rel="stylesheet" />
    <link
      rel="alternate"
      type="application/atom+xml"
      title="Atom Feed for www.micahlerner.com"
      href="/atom.xml"
    />
    <link
      rel="alternate"
      type="application/atom+xml"
      title="RSS Feed for www.micahlerner.com"
      href="/feed.xml"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/assets/images/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/assets/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/assets/images/favicon-16x16.png"
    />
    <link rel="manifest" href="/assets/imagessite.webmanifest" />
  </head>

  <body>
    <article>
  <section>
    <header>
      <a href="/">
        <h3>micahlerner.com</h3>
      </a>
    </header>
  </section>
  <h1>Shard Manager: A Generic Shard Management Framework for Geo-distributed Applications</h1>
  
  <h4>Published January 08, 2022</h4>
  <h5>
    Found something wrong?
    <a
      href="https://github.com/mlerner/mlerner.github.io/edit/master/_posts/2022-01-08-shard-manager-a-generic-shard-management-framework-for-geo-distributed-applications.md"
      >Submit a pull request!</a
    >
  </h5>
  <section id="post-content">
       <p class='discussion'>Discussion on <a href='https://news.ycombinator.com/item?id=30400447'> Hacker News</a></p>  
    <p>
      <em>
        This is one of the last papers I’m writing about from SOSP - I am trying out something new and publishing the queue of papers I plan on reading <a href="https://www.micahlerner.com/paper-queue">here</a>. These paper reviews can <a href="https://newsletter.micahlerner.com/">be delivered weekly to your inbox</a>, or you can subscribe to the <a href="https://www.micahlerner.com/feed.xml">Atom feed</a>. As always, feel free to reach out on <a href="https://twitter.com/micahlerner">Twitter</a> with feedback or suggestions!

        
      </em>
    </p>

     <p><a href="https://dl.acm.org/doi/10.1145/3477132.3483546">Shard Manager: A Generic Shard Management Framework for Geo-distributed Applications</a></p>

<p>This week’s paper is <em>Shard Manager: A Generic Shard Management Framework for Geo-distributed Applications</em>. The research describes a framework developed by Facebook for running <em>sharded applications</em> at scale.</p>

<p>Application sharding<label for="sm" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sm" class="margin-toggle" /><span class="sidenote">In the context of Shard Manager. </span> assigns subsets of requests to instances of an application, allowing tasks to specialize - a group of tasks specialized for a subset of requests is called a <em>shard</em>.</p>

<p>This approach is particularly useful when tasks fetch state or other metadata. As an example, a speech recognition application may load machine learning models to process languages. Assigning requests for different languages to different shards means that an application’s tasks don’t need to download every model (which would be time and bandwidth-intensive).</p>

<p>The Shard Manager paper not only discusses the technical aspects of running a sharding system at scale, but also includes data on usage and adoption inside Facebook. The paper’s information about which features were critical for users inside Facebook could help future efforts prioritize<label for="rakyll" class="margin-toggle sidenote-number"></label><input type="checkbox" id="rakyll" class="margin-toggle" /><span class="sidenote"><a href="https://rakyll.org/shardz/">@rakyll</a> has a great article about a potential implementation. </span>.</p>

<h2 id="what-are-the-papers-contributions">What are the paper’s contributions?</h2>

<p>The Shard Manager paper makes five main contributions: analysis of sharding usage at Facebook, design and implementation of the sharding system, a domain-specific language for defining sharding constraints, a constraint solver to place shards inside Facebook’s data centers, analysis of sharding usage at Facebook, and an evaluation of the system in production.</p>

<h2 id="motivation">Motivation</h2>

<p>The paper notes three main motivations for implementing Shard Manager: <em>increasing availability</em>, <em>supporting geo-distributed applications</em>, and <em>improved load balancing</em>.</p>

<p>To <em>increase availability</em>, Shard Manager aims to smoothly handle planned data center maintenance<label for="twine1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="twine1" class="margin-toggle" /><span class="sidenote">Facebook recently published a paper on their cluster manager, <a href="https://www.usenix.org/conference/osdi20/presentation/tang">Twine</a> </span> - if a container stops while processing user requests, those requests will fail, impacting the availability of the application. For the vast majority of containers, Facebook’s infrastructure knows in advance that the container is shutting down. Shard Manager aims to smoothly handle these shutdown events by coordinating with the container infrastructure, ensuring that to-be-shutdown containers stop receiving requests, and that requests that do make it to a shutting down container are forwarded to another active instance.</p>

<figure><img class="maincolumn-img" src="/assets/shard-manager/planned.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<p>The second major motivator for Shard Manager is enabling <em>geo-distributed applications</em> (an approach to independently deploying and scaling application shards). Before Shard Manager, services were primarily configured with <em>regional deployments</em> - to operate at Facebook scale, applications need to run in groups of datacenters called <em>regions</em>, with similar configurations in each region. For a sharded application, this meant reserving enough resources to serve every shard in every region, even if the shards weren’t needed - this constraint led to wasted data center resources. Furthermore, <em>regional deployments</em> were unwieldy in the event of data center or region maintenance, as other regions might not have the spare capacity to store additional copies of every shard.</p>

<figure><img class="maincolumn-img" src="/assets/shard-manager/geo-dist.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<p><em>Improved load balancing</em> is the third main motivation for Shard Manager. <em>Geo-distributed</em> applications can flexibly add and shift shards independently, simplifying the process of shifting load - rather than needing to make a copy of every shard, the system can add or move specific shards. At the same time, deciding when and how to place shards is a difficult optimization problem that Shard Manager needed to address.</p>

<h2 id="design">Design</h2>

<h3 id="the-sharding-abstraction">The Sharding Abstraction</h3>

<p>A critical piece of a sharding framework is assigning requests to shards. Shard Manager uses client-provided keys, called <em>app-keys</em>, to perform this mapping - continuing with the language server example, requests for English are sent to X shard, while requests for German and Mandarin might be sent to Y and Z shards.</p>

<p>The paper also discusses another approach, called <em>UUID-keys</em>, that map requests to shards based on <strong>hashes</strong> of keys provided by clients.</p>

<p>There are pros and cons to using <em>app-keys</em> versus <em>UUID-keys</em>, mostly based around data-locality - in the context of shard manager, data-locality means that similar data, potentially from related users or regions of the world, is placed on the same or nearby shards. The paper argues that <em>app-keys</em> provide data-locality, while <em>UUID-keys</em> do not.</p>

<p>Data locality would enable features like sequentially scanning multiple shards when performing a query. At the same-time, data locality could increase the potential for hot-spots, where reads of similar data all go to the same shard. Previous approaches to sharding frameworks, like Slicer<label for="slicer" class="margin-toggle sidenote-number"></label><input type="checkbox" id="slicer" class="margin-toggle" /><span class="sidenote">See the paper on Slicer <a href="https://www.usenix.org/conference/osdi16/technical-sessions/presentation/adya">here</a>. </span>, mention adding support for an <em>app-key</em> like approach to preserve data locality, but mention that, “many Google applications are already structured around single-key operations rather than scans, encouraged by the behavior of existing storage systems.”</p>

<h3 id="architecture">Architecture</h3>

<p>There are three main components of the Shard Manager architecture: <em>application clients/servers</em>, a <em>control plane</em><label for="control" class="margin-toggle sidenote-number"></label><input type="checkbox" id="control" class="margin-toggle" /><span class="sidenote"><em>Control plane</em> is used because it is the layer that performs management and metadata storage operations. </span>, and the <em>Cluster Manager</em>.</p>

<figure><img class="maincolumn-img" src="/assets/shard-manager/arch.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<p><em>Application servers</em> are the actual binaries that operate shards and receive requests from clients. Each server has a library that allows it to manage shard state (like reporting server health), register/deregister the shard from receiving requests, and hook into shard management events. When a shard performs management operations, it writes state to Zookeeper<label for="delos" class="margin-toggle sidenote-number"></label><input type="checkbox" id="delos" class="margin-toggle" /><span class="sidenote">It would be interesting to hear if Shard Manager considered adopting <a href="/2021/11/23/log-structured-protocols-in-delos.html">Delos</a>, a system for storing control plane data discussed in a previous paper review. </span>, a persistent data store.</p>

<p>To call an <em>application server</em>, an <em>application client</em> uses a library (called a <em>Service Router</em>). The client’s <em>Service Router</em> routes requests based on an <em>app-key</em> (which defines the mapping from request to shard), selecting an available shard based on state the library consumes from a service discovery<label for="service" class="margin-toggle sidenote-number"></label><input type="checkbox" id="service" class="margin-toggle" /><span class="sidenote">See this article on <a href="https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/">service discovery</a> for more background. </span> system. The <em>Service Router</em> periodically polls in the background to receive updates as shards are added, removed, and scaled.</p>

<p>The control plane of Shard Manager has three components:</p>

<ul>
  <li><em>Orchestrator</em>: an intermediary component that receives health and load information from application servers. It shares this data with other members of the control plane (like the components that schedule and scale shards), and propagates it to the <em>Service Discovery System</em> so that application clients have an updated view of the system.</li>
  <li><em>Allocator</em>: which decides where to put shards and how many to run.</li>
  <li><em>TaskController</em>: commmunicates with the <em>Cluster Manager</em> to request more resources (when scaling shards up) or to receive system events, like pending maintenance (which the <em>Task Controller</em> uses to shutdown shards gracefully). The <em>TaskController</em> propagates this information to the <em>Orchestrator</em> so that it can fulfill the job of shutting down application servers and shards gracefully.</li>
</ul>

<p>Lower in the infrastructure stack is the <em>Cluster Manager</em><label for="twine" class="margin-toggle sidenote-number"></label><input type="checkbox" id="twine" class="margin-toggle" /><span class="sidenote">For more information on the Cluster Manager, see the <a href="https://www.usenix.org/conference/osdi20/presentation/tang">Twine</a> paper. </span>, which communicates with the <em>TaskController</em> above to ensure that planned events, like “upcoming hardware maintenance events, kernel updates, and container starts/stops/moves” are handled gracefully, increasing application availability.</p>

<h2 id="implementation">Implementation</h2>

<p>The paper discusses how Shard Manager features aim to <em>increase application availability</em> and <em>supporting geo-distributed applications</em>, while <em>scaling the system</em>.</p>

<h3 id="maximize-application-availability">Maximize Application Availability</h3>

<p>Shard Manager implements two main techniques<label for="distribution" class="margin-toggle sidenote-number"></label><input type="checkbox" id="distribution" class="margin-toggle" /><span class="sidenote">The paper also mentions shard distribution across fault domains (like multiple regions and data centers) as increasing availability, but I defer discussion of shard distribution to placement and load balancing. </span> to increase application availability: <em>coordinating container shutdown with the Cluster Manager</em>, and <em>migrating shard traffic</em>.</p>

<p><em>Coordinating container shutdown</em> is critical to increasing availability because it ensures requests are not sent to a container that might shutdown while responding. Shard Manager must also ensure that planned maintenance events don’t take too much capacity offline at once (which would leave the application in a state where it is unable to respond to all incoming requests). To prevent both of these situations, Shard Manager’s <em>TaskController</em> communicates with the <em>Cluster Manager</em>, removing imminently decommissioning shards from service discovery and launching new shards as others prepare to go offline. If it is not possible to shift shards in anticipation of maintenance, the the <em>Task Controller</em> can warn the <em>Cluster Manager</em> that the proposed operations would put an application in an unsafe state.</p>

<p>Shard Manager also supports <em>migrating shard traffic</em> by implementing a graceful handover procedure. This process forwards in-progress requests from the old to new shard, ensuring that as few as possible are dropped on the floor. The system’s traffic migration also aims to handoff any new requests from application clients, who may continue to send requests to the old shard - the service discovery system is eventually consistent<label for="ec" class="margin-toggle sidenote-number"></label><input type="checkbox" id="ec" class="margin-toggle" /><span class="sidenote">See <a href="https://www.allthingsdistributed.com/2008/12/eventually_consistent.html">this blog post</a> from Amazon’s Werner Vogels on eventual consistency. </span>, so clients may temporarily use out-of-date routing state.</p>

<figure><img class="maincolumn-img" src="/assets/shard-manager/graceful.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<h3 id="shard-placement-and-load-balancing">Shard Placement and Load Balancing</h3>

<p><em>Geo-distributed applications</em> allow shards to be deployed independently to Facebook’s infrastructure around the world. While the technique provides several benefits, like independent scaling of individual shards, it also poses its own challenges - choosing how to place shards and when to move them is a difficult optimization problem. To solve the optimization problems associated with placement and load balancing, Shard Manager uses a <em>constraint solver</em>, configurable with a dedicated language for expressing <em>constraints</em>.</p>

<p>Shard Manager originally used a heuristic-based implementation to make load balancing decisions, which proved both complicated and difficult to scale. As a result, the system migrated to a constraint solver<label for="optimization" class="margin-toggle sidenote-number"></label><input type="checkbox" id="optimization" class="margin-toggle" /><span class="sidenote">The paper mentions a number of optimization techniques, including <a href="https://www.gurobi.com/resource/mip-basics/">mixed integer programming</a> (MIP), genetic algorithms, and <a href="https://towardsdatascience.com/optimization-techniques-simulated-annealing-d6a4785a1de7">simulated annealing</a>. I’m far from an expert in this type of research, so this could be a potential topic for a future paper review. </span>.</p>

<p>The inputs to the solver are <em>constraints</em> and <em>goals</em> - example constraints are system stability or server capacity, while example goals are load balancing across regions (to increase resource utilization) or spreading replicas across multiple data centers (to increase availability in the event of a problem with a specific data center).</p>

<figure><img class="maincolumn-img" src="/assets/shard-manager/dsl.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<p>An application configures its placement and load balancing using a domain-specific language<label for="dcm" class="margin-toggle sidenote-number"></label><input type="checkbox" id="dcm" class="margin-toggle" /><span class="sidenote">There is some very interesting and related research from VMWare on programmatically configuring cluster managers <a href="https://www.usenix.org/conference/osdi20/presentation/suresh">Building Scalable and Flexible Cluster Managers Using Declarative Programming</a>. </span> that translates into a form that a constraint solver can use. Even though Facebook has a high-powered constraint solver for data center problems<label for="ras" class="margin-toggle sidenote-number"></label><input type="checkbox" id="ras" class="margin-toggle" /><span class="sidenote">The paper links to another Facebook paper from SOSP on <a href="https://dl.acm.org/doi/10.1145/3477132.3483578">RAS: Continuously Optimized Region-Wide Datacenter Resource Allocation</a>. </span>, Shard Manager made further optimizations<label for="localsearch" class="margin-toggle sidenote-number"></label><input type="checkbox" id="localsearch" class="margin-toggle" /><span class="sidenote">The paper mentions <a href="https://www.degruyter.com/document/doi/10.1515/9780691187563/html">Local Search</a>, which “has grown from a simple heuristic idea into a mature field of research in combinatorial optimization that is attracting ever-increasing attention.” </span> to scale for its the high request rate.</p>

<h3 id="scaling-shard-manager">Scaling Shard Manager</h3>

<p>To scale Shard Manager, the system introduced two new concepts:</p>

<ul>
  <li><em>Partitions</em>: Each application is divided into many partitions, “where each partition typically comprises thousands of servers and hundreds of thousands of shard replicas.”</li>
  <li><em>mini-Shard Managers (mini-SM)</em>, which are essentially copies of an individual shard manager <em>control plane</em> (mentioned in a previous section). Each <em>mini-SM</em> handles a subset of servers and shards.</li>
</ul>

<figure><img class="maincolumn-img" src="/assets/shard-manager/scaled.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<p>The scale-out<label for="scaleout" class="margin-toggle sidenote-number"></label><input type="checkbox" id="scaleout" class="margin-toggle" /><span class="sidenote">“Scale-out” in this context means adding more <em>mini-Shard Managers</em> to cover more machines, as trying to make a single Shard Manager cover many machines would be difficult </span> version of Shard Manager also adds several new components including a <em>frontend</em> that serves as a balancer for communication with external systems (like the <em>Cluster Manager</em> and tooling), <em>Application Managers</em> that handle coordination of an application’s partitions over multiple mini-SMs, and a <em>partition registry</em> that <em>Application Managers</em> communicate with to get assignments of application partitions to mini-SMs.</p>

<h2 id="analysis-of-sharded-applications">Analysis of Sharded Applications</h2>

<p><em>Shard Manager</em> aims to provide support for as many sharded applications inside Facebook as possible, and provides data points what was critical to driving adoption. The paper argues for the importance of features in two areas that align with project’s motivation: <em>increasing availability</em> and <em>geo-distributed deployments</em>.</p>

<p>Many applications that migrated to Shard Manager take advantage of its <em>availability</em> features, in particular around handling planned events - “70% of SM applications choose to gracefully drain shards before a container restart.”</p>

<figure><img class="maincolumn-img" src="/assets/shard-manager/drains.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<p>The paper also notes similarly high-adoption of <em>geo-distributed applications</em> - 67% of sharded applications using Shard Manager use <em>geo-distributed deployments</em>.</p>

<figure><img class="maincolumn-img" src="/assets/shard-manager/geo-dist-adopt.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<h2 id="evaluation">Evaluation</h2>

<p>The paper evaluates Shard Manager using three criteria: whether the system succeeds at scale, whether it is able to achieve the original goals of increasing application availability and supporting geo-distributed applications, and whether Shard Manager can adequately solving the optimization problems to load-balance.</p>

<p>To evaluate scale, Shard Manager shows the number of applications, shards, and mini-SMs, demonstrating that the architecture is able to scale out as needed:</p>

<blockquote>
  <p>In total, SM manages hundreds of applications’ nearly 100M shards hosted on over one million servers, and those applications process billions of requests per second. SM gracefully handles millions of machine and network maintenance events per month.</p>
</blockquote>

<figure><img class="maincolumn-img" src="/assets/shard-manager/itworks.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<p>To evaluate availability, Shard Manager shows that applications using graceful migration show fewer spikes of failed requests relative to those that use no graceful migration strategy. The paper also shows how shard upgrades do not cause an increase in client error rate.</p>

<figure><img class="maincolumn-img" src="/assets/shard-manager/spikes.png" /><figcaption class="maincolumn-figure"></figcaption></figure>
<figure><img class="maincolumn-img" src="/assets/shard-manager/migration.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<p>To evaluate load balancing, the paper shows migrating shards to reduce network latency and load balancing over a changing environment and request rate.</p>

<figure><img class="maincolumn-img" src="/assets/shard-manager/lb.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<p>Lastly, the paper shows how the improved constraint solver is able to solve constraints at a much faster rate than the baseline solver - in fact, the original baseline solver isn’t able to complete.</p>

<figure><img class="maincolumn-img" src="/assets/shard-manager/constraints.png" /><figcaption class="maincolumn-figure"></figcaption></figure>

<h2 id="conclusion">Conclusion</h2>

<p>The <em>Shard Manager</em> paper details an impressive at scale production system, while sharing data points that will be useful to future implementers of sharding frameworks. I particuarly enjoyed how the paper discussed adoption and internal usecases when prioritizing development - I’ve seen this theme in a number of Facebook research papers, including Delos (which I previously covered <a href="/2021/11/23/log-structured-protocols-in-delos.html">here</a>) and <a href="https://www.usenix.org/conference/fast21/presentation/dong">RocksDB</a>. I’m also looking forward to future work from folks interested in an open source sharding framework, like the one <a href="https://rakyll.org/shardz/">@rakyll outlined</a>!</p>

<p>As always, I appreciated feedback and paper suggestions on <a href="https://twitter.com/micahlerner">Twitter</a>. Until next time!</p>


    <footer>
      <form
        action="https://gmail.us20.list-manage.com/subscribe/post?u=d1654f70a6addb0e9ce8afd83&amp;id=bab65ed2b1"
        method="post"
        id="mc-embedded-subscribe-form"
        name="mc-embedded-subscribe-form"
        class="validate"
        target="_blank"
        novalidate
      >
        <div id="mc_embed_signup_scroll">
          <h4>
            Follow me on
            <a href="https://twitter.com/micahlerner">Twitter</a> or subscribe
            below to get future paper reviews. Published weekly.
          </h4>
          <div>
            <input
              type="email"
              value=""
              name="EMAIL"
              class="email"
              id="tlemail"
              placeholder="email address"
              required
            />
            <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
            <div style="position: absolute; left: -5000px" aria-hidden="true">
              <input
                type="text"
                name="b_d1654f70a6addb0e9ce8afd83_bab65ed2b1"
                tabindex="-1"
                value=""
              />
            </div>
            <input
              type="submit"
              value="Subscribe"
              name="subscribe"
              id="mc-embedded-subscribe"
              class="button"
            />
          </div>
        </div>
      </form>
    </footer>
  </section>
  <section>
    Found something wrong?
    <a
      href="https://github.com/mlerner/mlerner.github.io/edit/master/_posts/2022-01-08-shard-manager-a-generic-shard-management-framework-for-geo-distributed-applications.md"
      >Submit a pull request!</a
    >
  </section>
</article>

<div id="portal-root">
  <div id="subscribe-container">
    <div id="gh-portal-triggerbtn-wrapper" class="gh-portal-triggerbtn-wrapper">
      <div class="gh-portal-triggerbtn-container with-label">
        <svg
          width="24"
          height="18"
          viewBox="0 0 24 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          style="width: 24px; height: 24px; color: rgb(255, 255, 255)"
        >
          <path
            d="M21.75 1.5H2.25c-.828 0-1.5.672-1.5 1.5v12c0 .828.672 1.5 1.5 1.5h19.5c.828 0 1.5-.672 1.5-1.5V3c0-.828-.672-1.5-1.5-1.5zM15.687 6.975L19.5 10.5M8.313 6.975L4.5 10.5"
            stroke="#fff"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          ></path>
          <path
            d="M22.88 2.014l-9.513 6.56C12.965 8.851 12.488 9 12 9s-.965-.149-1.367-.426L1.12 2.014"
            stroke="#fff"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          ></path></svg
        ><span class="gh-portal-triggerbtn-label"> Subscribe </span>
      </div>
    </div>
  </div>
</div>

<div id="popup-root" style="visibility: hidden">
  <div class="inner-popup-container">
    <div class="gh-portal-popup-background"></div>
    <div class="gh-portal-popup-wrapper signup">
      <div
        class="gh-portal-popup-container gh-portal-container-narrow signup"
        tabindex="-1"
      >
        <div class="gh-portal-content signup noplan">
          <div id="closeicon-email" class="gh-portal-closeicon-container">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              class="gh-portal-closeicon"
              alt="Close"
            >
              <defs>
                <style>
                  .a {
                    fill: none;
                    stroke: currentColor;
                    stroke-linecap: round;
                    stroke-linejoin: round;
                    stroke-width: 1.2px;
                  }
                </style>
              </defs>
              <path
                class="a"
                d="M.75 23.249l22.5-22.5M23.25 23.249L.75.749"
              ></path>
            </svg>
          </div>
          <header>
            <h2 class="gh-portal-main-title">Get essays a bit faster</h2>
          </header>
          <section>
            <div class="gh-portal-section">
              <form
                action="https://gmail.us20.list-manage.com/subscribe/post?u=d1654f70a6addb0e9ce8afd83&amp;id=bab65ed2b1"
                method="post"
                id="mc-embedded-subscribe-form"
                name="mc-embedded-subscribe-form"
                class="validate"
                target="_blank"
                novalidate=""
                _lpchecked="1"
              >
                <label for="mce-EMAIL"> </label>
                <p id="mce-email-describe" class="mt0">
                  I write about computer science research from the fields of
                  distributed systems and operating systems around once a week.
                </p>
                <p></p>
                <div id="mc_embed_signup_scroll">
                  <div>
                    <input
                      type="email"
                      value=""
                      name="EMAIL"
                      class="email"
                      id="tlemail"
                      placeholder="email address"
                      required=""
                    />

                    <div
                      style="position: absolute; left: -5000px"
                      aria-hidden="true"
                    >
                      <input
                        type="text"
                        name="b_d1654f70a6addb0e9ce8afd83_bab65ed2b1"
                        tabindex="-1"
                        value=""
                      />
                    </div>
                    <input
                      type="submit"
                      value="Subscribe"
                      name="subscribe"
                      id="mc-embedded-subscribe"
                      class="button"
                    />
                  </div>
                </div>
              </form>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>
</div>

<script id="mcjs">
  var subscribeButton = document.getElementById("gh-portal-triggerbtn-wrapper");
  var closeButton = document.getElementById("closeicon-email");
  var popupRoot = document.getElementById("popup-root");

  subscribeButton.addEventListener("click", function () {
    window.open('https://newsletter.micahlerner.com', '_blank');
    <!-- popupRoot.classList.toggle("m-fadeIn"); -->
    <!-- popupRoot.style.visibility = "visible"; -->
  });

  closeButton.addEventListener("click", function () {
    <!-- popupRoot.classList.toggle("m-fadeOut"); -->
    <!-- popupRoot.classList.toggle("m-fadeIn"); -->
    <!-- popupRoot.style.visibility = "hidden"; -->
  });
</script>

  </body>
</html>
